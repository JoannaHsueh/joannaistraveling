---
import type { ImageMetadata } from 'astro';
import { Icon } from 'astro-icon/components';
import Image from '~/components/common/Image.astro';
import PostTags from '~/components/blog/Tags.astro';

import { APP_BLOG } from 'astrowind:config';
import type { Post } from '~/types';

import { getPermalink } from '~/utils/permalinks';
import { findImage } from '~/utils/images';
import { getFormattedDate } from '~/utils/utils';

export interface Props {
  post: Post;
}

const { post } = Astro.props;
const image = (await findImage(post.image)) as ImageMetadata | undefined;
const link = APP_BLOG?.post?.isEnabled ? getPermalink(post.permalink, 'post') : '';
---

<article class="flex flex-col md:flex-row gap-4 md:gap-6 items-start max-w-4xl mx-auto">
  {
    image && (
      <div class="w-full md:w-[280px] flex-shrink-0">
        {link ? (
          <a href={link} class="block rounded overflow-hidden shadow">
            <Image
              src={image}
              alt={post.title}
              class="aspect-square object-cover w-full h-auto rounded shadow"
              width={300}
              loading="lazy"
              decoding="async"
            />
          </a>
        ) : (
          <Image
            src={image}
            alt={post.title}
            class="aspect-square object-cover w-full h-auto rounded shadow"
            width={300}
            loading="lazy"
            decoding="async"
          />
        )}
      </div>
    )
  }

  <div class="flex flex-col justify-between">
    <header>
      <div class="mb-1 text-sm text-muted dark:text-gray-400">
        <Icon name="tabler:clock" class="w-4 h-4 inline-block -mt-0.5" />
        <time datetime={String(post.publishDate)}>{getFormattedDate(post.publishDate)}</time>
        {
          post.author && (
            <>
              {' · '}
              <Icon name="tabler:user" class="w-4 h-4 inline-block -mt-0.5" />
              <span>{post.author.replaceAll('-', ' ')}</span>
            </>
          )
        }
        {
          post.category && (
            <>
              {' · '}
              <a class="hover:underline" href={getPermalink(post.category.slug, 'category')}>
                {post.category.title}
              </a>
            </>
          )
        }
      </div>
      <h2 class="text-xl sm:text-2xl font-bold leading-tight mb-2 font-heading dark:text-slate-300">
        {
          link ? (
            <a
              class="inline-block hover:text-primary dark:hover:text-blue-700 transition ease-in duration-200"
              href={link}
            >
              {post.title}
            </a>
          ) : (
            post.title
          )
        }
      </h2>
    </header>

    {post.excerpt && <p class="text-muted dark:text-slate-400 text-base">{post.excerpt}</p>}

    {
      post.tags && Array.isArray(post.tags) ? (
        <footer class="mt-3">
          <PostTags tags={post.tags} />
        </footer>
      ) : null
    }
  </div>
</article>
